<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>HYGHBYTE // Game Vault</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles.css" />
</head>

<body>

<!-- ðŸŽ„ LUMINI DE CRÄ‚CIUN -->
<% if (settings.lightsMode && settings.lightsMode !== "off") { %>
  <div class="christmas-lights <%= settings.lightsMode %>"></div>
<% } %>

<!-- HEADER -->
<header class="hb-header">
  <div class="hb-header-left">
    <span class="hb-logo-main">HYGHBYTE</span>
    <span class="hb-logo-sub">GAME VAULT</span>
  </div>

  <div class="hb-header-right">
    <button id="themeToggle" class="hb-header-btn">ðŸŒ™</button>
    <button id="randomBtn" class="hb-header-btn hb-random-btn">ðŸŽ² Random game</button>
  </div>
</header>

<!-- â„ï¸ NINSOARE -->
<% if (settings.snow) { %>
  <script src="/snow-v3.js"></script>
<% } %>

<main class="hb-main">
  <div class="hb-shell hb-layout">

    <!-- SIDEBAR -->
    <aside class="hb-sidebar">
      <div class="hb-sidebar-section">
        <div class="hb-sidebar-title">LIBRARY</div>

        <button class="hb-sidebar-item is-active" data-filter="all">
          <span class="hb-sidebar-dot all"></span>
          Toate jocurile
        </button>
      </div>

      <div class="hb-sidebar-section">
        <div class="hb-sidebar-title">SURSE</div>

        <button class="hb-sidebar-item" data-filter="steam">
          <span class="hb-sidebar-dot steam"></span>
          Steam
        </button>

        <button class="hb-sidebar-item" data-filter="itch">
          <span class="hb-sidebar-dot itch"></span>
          itch.io
        </button>
      </div>
    </aside>

    <!-- CONTENT -->
    <section class="hb-content">

      <!-- CASE OPENING -->
      <div id="caseOverlay" class="case-overlay" style="display:none;">
        <div class="case-box" id="caseBox">
          <div class="case-strip" id="caseStrip"></div>
          <div class="case-marker"></div>
        </div>
      </div>

      <div class="hb-steam-titlebar">
        <h2 class="hb-steam-title">Biblioteca de jocuri</h2>
        <span class="hb-games-count"><%= games.length %> titluri</span>
      </div>

      <!-- GRID -->
      <div class="hb-grid">
        <% games.forEach(game => { %>
          <article class="hb-card" data-source="<%= game.source %>">

            <div class="hb-card-image-wrap">
              <% if (game.imageUrl) { %>
                <img 
                  src="<%= game.imageUrl %>" 
                  class="hb-card-image"
                  alt="<%= game.title %>"
                  loading="lazy"
                >
              <% } else { %>
                <div class="hb-card-placeholder">HYGHBYTE</div>
              <% } %>
            </div>

            <div class="hb-card-body">
              <h3 class="hb-card-title"><%= game.title %></h3>

              <% if (game.genres) { %>
                <p class="hb-card-genres"><%= game.genres %></p>
              <% } %>

              <div class="hb-card-bottom">

                <% if (game.playUrl) { %>
                  <a href="<%= game.playUrl %>" target="_blank" class="hb-button hb-button-primary">
                    â–¶ JoacÄƒ
                  </a>
                <% } %>

                <div class="hb-source-wrapper">
                  <% if (game.source === 'steam') { %>
                    <img 
                      src="https://upload.wikimedia.org/wikipedia/commons/8/83/Steam_icon_logo.svg"
                      class="hb-source-icon"
                      alt="Steam"
                      loading="lazy"
                    >
                  <% } else if (game.source === 'itch') { %>
                    <img 
                      src="https://img.icons8.com/ios11/600/FA5252/itch-io.png"
                      class="hb-source-icon"
                      alt="itch.io"
                      loading="lazy"
                    >
                  <% } %>
                </div>

              </div>
            </div>

          </article>
        <% }) %>
      </div>

    </section>
  </div>
</main>

<footer class="hb-footer">
  <div class="hb-shell hb-footer-inner">
    <span class="hb-footer-text">
      HYGHBYTE nu este afiliat cu Steam, itch.io sau Valve Corporation. Toate mÄƒrcile aparÈ›in deÈ›inÄƒtorilor lor.
    </span>
  </div>
</footer>

<script>
// ===== THEME =====
const themeBtn = document.getElementById("themeToggle");
function setTheme(mode) {
  document.body.classList.toggle("light", mode === "light");
  themeBtn.innerHTML = mode === "light" ? "ðŸŒ™" : "â˜€ï¸";
  localStorage.setItem("hyghbyteTheme", mode);
}
setTheme(localStorage.getItem("hyghbyteTheme") || "dark");
themeBtn.addEventListener("click", () => {
  setTheme(document.body.classList.contains("light") ? "dark" : "light");
});

// ===== LISTÄ‚ RANDOM =====
const gamesList = JSON.parse(`<%- JSON.stringify(games.map(g => ({
  title: g.title,
  url: g.playUrl,
  image: g.imageUrl || "/fallback.png"
}))) %>`);

// ===== CASE OPENING =====
const randomBtn = document.getElementById("randomBtn");
const overlay = document.getElementById("caseOverlay");
const strip = document.getElementById("caseStrip");
const box = document.getElementById("caseBox");

randomBtn.addEventListener("click", () => {
  if (!gamesList.length) return;

  const winner = gamesList[Math.floor(Math.random() * gamesList.length)];
  const seq = [];

  for (let i = 0; i < 12; i++) seq.push(gamesList[Math.floor(Math.random() * gamesList.length)]);
  seq.push(winner);
  for (let i = 0; i < 12; i++) seq.push(gamesList[Math.floor(Math.random() * gamesList.length)]);

  strip.innerHTML = "";
  seq.forEach((g, i) => {
    const d = document.createElement("div");
    d.className = "case-item";
    d.innerHTML = `
      <div class="case-item-inner">
        <img class="case-item-img" src="${g.image}" loading="lazy">
        <div class="case-item-title">${g.title}</div>
      </div>`;
    if (i === 12) d.dataset.winner = true;
    strip.appendChild(d);
  });

  overlay.style.display = "flex";

  strip.style.transition = "none";
  strip.style.transform = "translateX(0)";
  void strip.offsetWidth;

  const w = strip.children[0].offsetWidth;
  const bw = box.offsetWidth;

  const target = (12 * w) - (bw / 2) + (w / 2);

  strip.style.transition = "transform 3.2s cubic-bezier(.1,.35,.08,1)";
  strip.style.transform = `translateX(-${target}px)`;

  setTimeout(() => {
    strip.querySelector("[data-winner]").classList.add("winner");
    setTimeout(() => {
      overlay.style.display = "none";
      if (winner.url) window.open(winner.url, "_blank");
    }, 1000);
  }, 3300);
});

// ===== FILTER =====
document.querySelectorAll(".hb-sidebar-item[data-filter]").forEach(btn => {
  btn.addEventListener("click", () => {
    const f = btn.dataset.filter;

    document.querySelectorAll(".hb-sidebar-item").forEach(b => b.classList.remove("is-active"));
    btn.classList.add("is-active");

    document.querySelectorAll(".hb-card").forEach(c => {
      c.style.display = (f === "all" || c.dataset.source === f) ? "" : "none";
    });
  });
});
</script>

</body>
</html>
