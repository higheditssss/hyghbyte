<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>HYGHBYTE // Game Vault</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles.css" />
</head>

<body>

<header class="hb-header">
  <div>
    <span class="hb-logo-main">HYGHBYTE</span>
    <span class="hb-logo-sub">GAME VAULT</span>
  </div>

  <div class="hb-header-right">
    <a href="https://highstatss.vercel.app/" target="_blank" class="hb-kick-btn">HIGHSTATS</a>
    <button id="caseBtn" class="hb-random-btn">üéÅ Open Case</button>
  </div>
</header>

<main class="hb-main">

  <!-- ======================= FEATURED + SIDEBAR INLINE ======================= -->
  <section class="featured-section">
    <h2 class="featured-title">Featured Games</h2>

    <div class="featured-with-sidebar">

      <!-- === Sidebar Mutat L√¢ngƒÉ Featured === -->
      <aside class="hb-sidebar sidebar-inline">
        <div class="hb-sidebar-title">Library</div>

        <button class="hb-sidebar-item is-active" data-filter="all">
          <span class="hb-sidebar-dot all"></span> Toate jocurile
        </button>

        <button class="hb-sidebar-item" data-filter="steam">
          <span class="hb-sidebar-dot steam"></span> Steam
        </button>

        <button class="hb-sidebar-item" data-filter="itch">
          <span class="hb-sidebar-dot itch"></span> itch.io
        </button>
      </aside>

      <!-- === FEATURED SLIDER === -->
      <div class="featured-slider">
        <button id="featured-prev" class="featured-arrow left">‚ùÆ</button>

        <div id="featured-container">
          <% featuredGames.forEach((g, index) => { %>
            <div class="featured-slide <%= index === 0 ? 'active' : '' %>"
                 style="--bg:url('<%= g.featuredImage || g.imageUrl %>')">

              <img src="<%= g.featuredImage || g.imageUrl %>" class="featured-big-img">

              <div class="featured-right">
                <h3><%= g.title %></h3>

                <% if (g.genres) { %>
                  <p class="featured-genres"><%= g.genres %></p>
                <% } %>

                <a href="<%= g.playUrl %>" class="featured-play-btn" target="_blank">
                  ‚ñ∂ JoacƒÉ acum
                </a>
              </div>
            </div>
          <% }) %>
        </div>

        <button id="featured-next" class="featured-arrow right">‚ùØ</button>
      </div>

    </div>
  </section>

  <!-- ======================= GAME GRID (NORMAL) ======================= -->
  <section class="hb-content">
    <div class="hb-grid">

      <% games.forEach(g => { %>
        <article class="hb-card" data-source="<%= g.source %>">
          <div class="hb-card-image-wrap">
            <img src="<%= g.imageUrl %>" class="hb-card-image">
          </div>

          <div class="hb-card-body">
            <h3 class="hb-card-title"><%= g.title %></h3>

            <% if (g.genres) { %>
              <p class="hb-card-genres"><%= g.genres %></p>
            <% } %>

            <div class="hb-card-bottom">
              <a href="<%= g.playUrl %>" target="_blank" class="hb-button-primary">
                ‚ñ∂ JoacƒÉ
              </a>

              <% if (g.source === 'steam') { %>
                <img src="https://upload.wikimedia.org/wikipedia/commons/8/83/Steam_icon_logo.svg"
                     class="hb-source-icon">
              <% } else if (g.source === 'itch') { %>
                <img src="https://static-00.iconduck.com/assets.00/itch-io-icon-2048x2048-7q3p8x7n.png"
                     class="hb-source-icon">
              <% } %>
            </div>
          </div>
        </article>
      <% }) %>

    </div>
  </section>

</main>

<footer class="hb-footer">
  HYGHBYTE 2025 ‚Äî Not affiliated with Steam or itch.io.
</footer>

<!-- ======================= CASE OPENING POPUP ======================= -->
<div id="casePopup" class="case-popup hidden">
  <div class="case-strip-container">
    <div id="caseStrip" class="case-strip"></div>
  </div>
</div>

<!-- ======================= FEATURED SLIDER SCRIPT ======================= -->
<script>
  const slides = document.querySelectorAll(".featured-slide");
  let index = 0;

  function showSlide(i) {
    slides.forEach(s => s.classList.remove("active"));
    slides[i].classList.add("active");
  }

  if (slides.length > 0) {
    document.getElementById("featured-prev").onclick = () => {
      index = (index - 1 + slides.length) % slides.length;
      showSlide(index);
    };

    document.getElementById("featured-next").onclick = () => {
      index = (index + 1) % slides.length;
      showSlide(index);
    };
  }
</script>

<!-- ======================= CASE OPENING SCRIPT ======================= -->
<script>
const allGames = <%- JSON.stringify(games) %>;
const caseBtn = document.getElementById("caseBtn");

function openCase() {
  if (!allGames || allGames.length === 0) return;

  const popup = document.getElementById("casePopup");
  const strip = document.getElementById("caseStrip");

  popup.classList.remove("hidden");
  strip.innerHTML = "";
  strip.style.transition = "none";
  strip.style.transform = "translateX(0)";

  const rollList = [];
  for (let i = 0; i < 55; i++) {
    const g = allGames[Math.floor(Math.random() * allGames.length)];
    rollList.push(g);

    const img = document.createElement("img");
    img.src = g.imageUrl;
    strip.appendChild(img);
  }

  const winner = rollList[rollList.length - 1];

  const itemWidth = 230 + 12;
  const totalMove = (rollList.length - 4) * itemWidth;

  setTimeout(() => {
    strip.style.transition = "transform 3s cubic-bezier(0.1, 0.7, 0.2, 1)";
    strip.style.transform = `translateX(-${totalMove}px)`;
  }, 50);

  setTimeout(() => {
    window.location.href = winner.playUrl;
  }, 3100);
}

caseBtn.addEventListener("click", openCase);
</script>

</body>
</html>
